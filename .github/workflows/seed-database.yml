# Seed Production Database
# Manually triggered workflow to seed the production database with essential data
# 
# Usage: 
#   1. Go to Actions tab
#   2. Select "Seed Production Database"
#   3. Click "Run workflow"
#   4. Choose seed type (full or essential)
#
# Note: This uses upsert, so it's safe to run multiple times

name: Seed Production Database

on:
  workflow_dispatch:
    inputs:
      seed_type:
        description: 'Seed Type'
        required: true
        type: choice
        default: 'full'
        options:
          - full
          - essential
      clear_first:
        description: 'Clear existing data before seeding'
        required: false
        type: boolean
        default: false

env:
  NODE_ENV: production

jobs:
  seed:
    name: Seed Database
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Seed Database
        env:
          MONGODB_URI: ${{ secrets.MONGODB_URI }}
          CI: 'true'
        run: |
          echo "üå± Seeding production database..."
          echo "Seed type: ${{ github.event.inputs.seed_type }}"
          echo "Clear first: ${{ github.event.inputs.clear_first }}"
          
          # Build the command
          CMD="node scripts/seed-production.js"
          
          if [ "${{ github.event.inputs.seed_type }}" = "essential" ]; then
            CMD="$CMD --essential"
          fi
          
          if [ "${{ github.event.inputs.clear_first }}" = "true" ]; then
            CMD="$CMD --clear"
          fi
          
          echo "Running: $CMD"
          $CMD

      - name: Seed Summary
        if: success()
        run: |
          echo "‚úÖ Database seeding completed successfully!"
          echo ""
          echo "üìã Next Steps:"
          echo "1. Check the workflow logs for UNMAPPED_CATEGORY_ID and PRICEOYE_PLATFORM_ID"
          echo "2. Update your repository secrets if needed"
          echo "3. These IDs are required for the scraping workflows to work correctly"

      - name: Notify on Failure
        if: failure()
        run: |
          echo "‚ùå Database seeding failed!"
          echo "Please check the logs above for error details."
          exit 1
